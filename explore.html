<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Explore Sellers - Jesmont Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f9fafb;
    }

    .category-btn {
      transition: all 0.3s ease;
    }

    .listing-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>

<body class="px-6 py-8 max-w-7xl mx-auto">
  <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Explore Sellers</h1>

  <!-- Search Bar -->
  <div class="mb-6 w-full sm:w-2/3 mx-auto relative">
    <input type="text" id="searchBar" placeholder="Search sellers or products..."
      class="w-full px-5 py-3 rounded-full border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none" />
    <span class="absolute top-3.5 right-5 text-gray-400"><i class="fas fa-search"></i></span>
  </div>

  <!-- Category Filters -->
  <div class="flex overflow-x-auto mb-6 gap-2 scrollbar-hide" id="categoryFilters">
    <button class="category-btn bg-blue-100 text-blue-800 px-4 py-2 rounded-full" data-category="all">All</button>
    <button class="category-btn bg-green-100 text-green-800 px-4 py-2 rounded-full" data-category="electronics">Electronics</button>
    <button class="category-btn bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full" data-category="fashion">Fashion</button>
    <button class="category-btn bg-purple-100 text-purple-800 px-4 py-2 rounded-full" data-category="beauty">Beauty</button>
    <button class="category-btn bg-pink-100 text-pink-800 px-4 py-2 rounded-full" data-category="sports">Sports</button>
    <button class="category-btn bg-red-100 text-red-800 px-4 py-2 rounded-full" data-category="toys">Toys</button>
  </div>

  <!-- Seller Profiles - Horizontal Scroll -->
  <div id="sellerProfiles" class="flex overflow-x-auto gap-4 mb-8 scrollbar-hide px-2 py-1 border-b border-gray-300">
    <!-- Seller profile cards inserted here -->
  </div>

  <!-- Product Listings Below -->
  <div id="sellerContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <!-- Seller listing cards inserted here -->
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDlakKgMzhADOywIOg4iTCJ5sUFXLMGwVg",
      authDomain: "jesmont-marketplace.firebaseapp.com",
      projectId: "jesmont-marketplace",
      storageBucket: "jesmont-marketplace.appspot.com",
      messagingSenderId: "543717950238",
      appId: "1:543717950238:web:df009d49e88a2ea010bf0f",
      measurementId: "G-56TMB41PS8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allSellers = [];
    let selectedCategory = "all";

    async function loadSellers() {
      const sellerProfiles = document.getElementById("sellerProfiles");
      const sellerContainer = document.getElementById("sellerContainer");

      sellerProfiles.innerHTML = "<p>Loading seller profiles...</p>";
      sellerContainer.innerHTML = "<p>Loading sellers...</p>";

      try {
        const snapshot = await getDocs(collection(db, "sellers"));
        allSellers = snapshot.docs.map(doc => {
          const data = doc.data();
          return {
            id: doc.id,
            ...data,
            category: (data.category || "uncategorized").toLowerCase(),
            logoURL: data.logoURL || null,
            businessDescription: data.description || data.businessDescription || ""
          };
        });

        if (allSellers.length === 0) {
          sellerProfiles.innerHTML = "<p class='text-gray-500'>No sellers found.</p>";
          sellerContainer.innerHTML = "";
          return;
        }

        // Display seller profiles horizontally
        displaySellerProfiles(allSellers);

        // Display seller cards (listings) below
        displaySellers(allSellers);

      } catch (err) {
        console.error("Error loading sellers:", err);
        sellerProfiles.innerHTML = "<p class='text-red-500'>Failed to load seller profiles.</p>";
        sellerContainer.innerHTML = "<p class='text-red-500'>Failed to load sellers.</p>";
      }
    }

    function displaySellerProfiles(sellers) {
      const sellerProfiles = document.getElementById("sellerProfiles");
      sellerProfiles.innerHTML = "";

      sellers.forEach(seller => {
        const profileCard = document.createElement("div");
        profileCard.className = "flex flex-col items-center min-w-[120px] cursor-pointer hover:scale-105 transition-transform";

        profileCard.innerHTML = `
          <img src="${seller.logoURL || 'https://via.placeholder.com/100?text=No+Image'}" 
               alt="${seller.businessName} Logo"
               class="w-20 h-20 rounded-full object-cover border-2 border-blue-500 mb-2" />
          <p class="text-sm font-semibold text-center max-w-[120px] truncate">${seller.businessName}</p>
        `;

        // Optional: clicking profile could filter products by seller or navigate
        profileCard.addEventListener('click', () => {
          // For demo, filter listings to this seller only:
          filterBySeller(seller.id);
        });

        sellerProfiles.appendChild(profileCard);
      });
    }

    function displaySellers(sellers) {
      const sellerContainer = document.getElementById("sellerContainer");
      sellerContainer.innerHTML = "";

      if (sellers.length === 0) {
        sellerContainer.innerHTML = "<p class='text-gray-500 text-center'>No matching sellers found.</p>";
        return;
      }

      sellers.forEach(seller => {
        const card = document.createElement("div");
        card.classList.add("listing-card", "bg-white", "p-4", "rounded", "shadow", "hover:shadow-lg", "transition", "duration-300");

        card.innerHTML = `
          <h3 class="text-lg font-semibold mb-1">${seller.businessName}</h3>
          <p class="text-sm text-gray-700 mb-2">${seller.businessDescription || ""}</p>
          <p class="text-xs text-gray-500 mb-2">Category: ${seller.category}</p>
        `;

        sellerContainer.appendChild(card);
      });
    }

    function setupFilters() {
      const categoryButtons = document.querySelectorAll(".category-btn");

      categoryButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          selectedCategory = btn.dataset.category.toLowerCase();

          categoryButtons.forEach(b => b.classList.remove("ring", "ring-blue-500"));
          btn.classList.add("ring", "ring-blue-500");

          filterSellers();
        });
      });

      const searchBar = document.getElementById("searchBar");
      searchBar.addEventListener("input", () => {
        filterSellers();
      });
    }

    function filterSellers() {
      const searchValue = document.getElementById("searchBar").value.toLowerCase();

      const filtered = allSellers.filter(seller => {
        const name = (seller.businessName || "").toLowerCase();
        const description = (seller.businessDescription || "").toLowerCase();
        const category = (seller.category || "uncategorized").toLowerCase();

        const matchesSearch = name.includes(searchValue) || description.includes(searchValue);
        const matchesCategory = selectedCategory === "all" || category === selectedCategory;

        return matchesSearch && matchesCategory;
      });

      displaySellerProfiles(filtered);
      displaySellers(filtered);
    }

    // Filter listings by seller id on clicking profile
    function filterBySeller(sellerId) {
      const filtered = allSellers.filter(seller => seller.id === sellerId);
      displaySellerProfiles(filtered);
      displaySellers(filtered);
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadSellers();
      setupFilters();
    });
  </script>

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/ef19c1d6c8.js" crossorigin="anonymous"></script>
</body>

</html>
